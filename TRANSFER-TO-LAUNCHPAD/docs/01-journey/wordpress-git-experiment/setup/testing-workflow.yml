# WordPress Git Integration - Testing Workflow
# This is a structured task list, not executable YAML
# Follow each phase sequentially

workflow:
  name: WordPress Git Integration Testing
  date: 2026-01-10
  estimated_duration: 5 hours

  prerequisites:
    credentials_required:
      - name: SITEGROUND_HOST
        description: SiteGround SSH hostname
        example: us123.siteground.us
        where_to_find: Site Tools → Devs → SSH Keys Manager

      - name: SITEGROUND_USER
        description: SiteGround SSH username
        example: u123-abcdefgh
        where_to_find: Site Tools → Devs → SSH Keys Manager

      - name: SSH_PRIVATE_KEY
        description: SSH private key content
        format: PEM (starts with -----BEGIN)
        where_to_find: Generate in SSH Keys Manager, download .key file

      - name: SITEGROUND_SITE
        description: Site folder name
        example: lastapple.com
        where_to_find: Site Tools → File Manager

      - name: GITHUB_PAT
        description: GitHub Personal Access Token
        scopes: [repo]
        where_to_find: github.com/settings/tokens

      - name: WP_SITE_URL
        description: WordPress site URL
        example: https://staging.lastapple.com
        note: Use staging site, NOT production

      - name: WP_ADMIN_USER
        description: WordPress admin username

      - name: WP_APP_PASSWORD
        description: WordPress Application Password
        where_to_find: WP Admin → Users → Profile → Application Passwords
        note: Include spaces in password

    local_requirements:
      - name: git
        check_command: git --version
        minimum_version: "2.0"

      - name: node
        check_command: node --version
        minimum_version: "18.0"

      - name: npm
        check_command: npm --version
        minimum_version: "9.0"

      - name: claude
        check_command: claude --version
        note: Claude Code CLI

  phases:
    - phase: 1
      name: MCP Server Installation
      duration: 60 minutes

      tasks:
        - id: 1.1
          name: Install GitHub MCP Server
          command: claude mcp add github -s user -- npx -y @modelcontextprotocol/server-github
          env_required:
            - GITHUB_PERSONAL_ACCESS_TOKEN
          validation:
            method: Test repo list
            command: Ask Claude to list your GitHub repos

        - id: 1.2
          name: Install SSH MCP Server
          command: claude mcp add ssh -s user -- npx -y ssh-mcp
          env_required:
            - SSH_HOST
            - SSH_USER
            - SSH_PORT
            - SSH_PRIVATE_KEY_PATH
          validation:
            method: Test SSH connection
            command: Ask Claude to run 'whoami' on remote server

        - id: 1.3
          name: Install WordPress MCP Server
          command: claude mcp add wordpress -s user -- npx -y @instawp/mcp-wp
          env_required:
            - WP_URL
            - WP_USER
            - WP_APP_PASSWORD
          validation:
            method: Test WP connection
            command: Ask Claude to list recent posts

        - id: 1.4
          name: Verify all MCP servers
          command: claude mcp list
          success_criteria:
            - github server shows as configured
            - ssh server shows as configured
            - wordpress server shows as configured

      checkpoint:
        description: All three MCP servers installed and responding
        rollback: Remove servers with 'claude mcp remove [name]'

    - phase: 2
      name: WordPress Plugin Setup
      duration: 45 minutes

      tasks:
        - id: 2.1
          name: SSH into SiteGround
          method: Via SSH MCP or manual
          command: ssh -p 18765 ${SITEGROUND_USER}@${SITEGROUND_HOST}

        - id: 2.2
          name: Navigate to WordPress directory
          command: cd /home/${SITEGROUND_USER}/www/${SITEGROUND_SITE}/public_html

        - id: 2.3
          name: Verify WP-CLI works
          command: wp --info
          expected_output: PHP version, WP-CLI version, WordPress path

        - id: 2.4
          name: Download DB Version Control plugin
          commands:
            - cd wp-content/plugins
            - git clone https://github.com/robertdevore/db-version-control.git
          alternative: Download ZIP and upload via SFTP

        - id: 2.5
          name: Activate plugin
          command: wp plugin activate db-version-control

        - id: 2.6
          name: Run initial export
          command: wp dbvc export
          expected_output: JSON files created in sync/ folder

        - id: 2.7
          name: Verify export
          commands:
            - ls -la wp-content/plugins/db-version-control/sync/
            - cat wp-content/plugins/db-version-control/sync/options.json | head -50
          success_criteria:
            - options.json exists
            - menus.json exists
            - post/ directory exists
            - page/ directory exists

      checkpoint:
        description: Plugin installed, initial export complete, JSON files readable
        verify_command: wp dbvc export --dry-run

    - phase: 3
      name: Auto-Export Testing
      duration: 30 minutes

      tasks:
        - id: 3.1
          name: Note current file timestamps
          command: ls -la wp-content/plugins/db-version-control/sync/page/

        - id: 3.2
          name: Edit a page in WordPress
          method: Via WP Admin or WordPress MCP
          action: Change title or content of any page

        - id: 3.3
          name: Check if JSON updated
          command: ls -la wp-content/plugins/db-version-control/sync/page/
          success_criteria: Timestamp changed on edited page's JSON

        - id: 3.4
          name: View the diff
          commands:
            - cd wp-content/plugins/db-version-control/sync
            - git diff (if git initialized)
          alternative: Compare JSON content manually

        - id: 3.5
          name: Test with different content types
          tests:
            - Edit a post → verify post/*.json updates
            - Edit a menu → verify menus.json updates
            - Change site title → verify options.json updates

      checkpoint:
        description: Content changes automatically export to JSON
        issue_if_fails: Check plugin settings, may need hook configuration

    - phase: 4
      name: Git Integration
      duration: 60 minutes

      tasks:
        - id: 4.1
          name: Initialize Git in sync folder
          commands:
            - cd wp-content/plugins/db-version-control/sync
            - git init
            - git add .
            - git commit -m "Initial content export"

        - id: 4.2
          name: Create GitHub repository
          method: Via GitHub MCP
          command: Ask Claude to create repo 'wp-content-sync'
          settings:
            private: true
            description: "WordPress content version control"

        - id: 4.3
          name: Add remote and push
          commands:
            - git remote add origin https://github.com/${GITHUB_USER}/wp-content-sync.git
            - git branch -M main
            - git push -u origin main

        - id: 4.4
          name: Verify on GitHub
          check: Visit repo URL, confirm files visible

        - id: 4.5
          name: Test change tracking
          steps:
            - Edit page in WordPress
            - Run: git status (should show modified file)
            - Run: git diff (should show content change)
            - Commit: git add . && git commit -m "Updated [page name]"
            - Push: git push

        - id: 4.6
          name: Verify change on GitHub
          check: View commit diff on GitHub

      checkpoint:
        description: Changes flow from WordPress → Git → GitHub
        verify: Can see content history on GitHub

    - phase: 5
      name: GitHub Actions Deployment
      duration: 60 minutes

      tasks:
        - id: 5.1
          name: Add secrets to GitHub repo
          location: Repo → Settings → Secrets → Actions
          secrets_to_add:
            - SSH_PRIVATE_KEY: (your private key content)
            - SITEGROUND_HOST: (your host)
            - SITEGROUND_USER: (your username)
            - SITEGROUND_SITE: (your site folder)

        - id: 5.2
          name: Create workflow file
          file: .github/workflows/deploy-to-wordpress.yml
          source: Use deploy-to-wordpress.yml from setup folder

        - id: 5.3
          name: Commit and push workflow
          commands:
            - git add .github/
            - git commit -m "Add deployment workflow"
            - git push

        - id: 5.4
          name: Test deployment (manual trigger)
          steps:
            - Go to repo → Actions tab
            - Select "Deploy to WordPress"
            - Click "Run workflow"
            - Watch execution logs

        - id: 5.5
          name: Test deployment (push trigger)
          steps:
            - Edit a JSON file locally or via GitHub
            - Commit and push
            - Watch Actions tab for automatic run
            - Verify site updated

      checkpoint:
        description: Git push triggers automatic deployment to WordPress
        success_time: Under 5 minutes from push to live

    - phase: 6
      name: Mobile/Voice Workflow
      duration: 30 minutes

      tasks:
        - id: 6.1
          name: Install GitHub mobile app
          platforms: [iOS, Android]

        - id: 6.2
          name: Navigate to content file
          path: sync/page/[any-page].json

        - id: 6.3
          name: Edit using voice
          steps:
            - Tap Edit (pencil icon)
            - Use voice-to-text to dictate change
            - Review the change

        - id: 6.4
          name: Commit via mobile
          steps:
            - Scroll down to commit section
            - Add commit message (can use voice)
            - Tap "Commit changes"

        - id: 6.5
          name: Verify deployment
          steps:
            - Watch GitHub Actions (can view in app)
            - Check website for update
            - Note total time from voice → live

      checkpoint:
        description: Can edit content via voice on phone, deploys automatically
        success_criteria: End-to-end under 5 minutes

  post_testing:
    documentation:
      - Update RESEARCH-FINDINGS.md with real results
      - Note any issues or limitations discovered
      - Calculate actual time vs estimated
      - Determine if ready for client offering

    decision_matrix:
      questions:
        - Is this simpler than manual editing?
        - Would clients understand this workflow?
        - Is the risk of data loss acceptable?
        - Does it save time vs current workflow?
        - What would you charge for this service?
        - Is it production-ready?

    next_steps:
      if_successful:
        - Document as premium service offering
        - Create client-facing explanation
        - Set pricing tier
        - Test on one willing client

      if_partial:
        - Document what works and what doesn't
        - Consider theme-only version control
        - Revisit in 30 days for plugin updates

      if_failed:
        - Document failure points
        - Archive for future reference
        - Stick with traditional workflow

  troubleshooting:
    common_issues:
      - issue: SSH connection refused
        causes:
          - Wrong port (must be 18765)
          - Key not added to SiteGround
          - IP blocked by firewall
        solution: Verify key in SiteGround, check port, whitelist IP

      - issue: WP-CLI not found
        causes:
          - Not installed on server
          - Path not in environment
        solution: SiteGround has WP-CLI pre-installed, use full path

      - issue: Plugin not exporting
        causes:
          - Permissions on sync folder
          - PHP memory limit
          - Plugin conflict
        solution: Check folder permissions (755), increase memory, deactivate other plugins

      - issue: GitHub Actions failing
        causes:
          - Secrets not set correctly
          - SSH key format wrong
          - Path incorrect
        solution: Check Actions logs, verify secrets, test SSH manually first

      - issue: Content not importing
        causes:
          - JSON malformed
          - Import overwrote data
          - Plugin error
        solution: Validate JSON, backup before import, check error logs
